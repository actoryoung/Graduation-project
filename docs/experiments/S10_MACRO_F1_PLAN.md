# S10: Macro F1优化 - 任务计划

**创建日期**: 2026-02-09
**策略**: 策略C（S10 → S6，不做S8）
**预计时间**: 2周（10个工作日）

---

## 📋 任务分解

| 阶段 | 任务 | 具体内容 | 预计时间 | 状态 |
|------|------|---------|----------|------|
| **S10-1** | 数据分析 | 分析当前模型在各阈值下的Macro F1表现 | 1天 | ✅ 完成 |
| **S10-2** | 阈值优化 | 网格搜索最优决策阈值组合 | 2天 | ✅ 完成 |
| **S10-3** | 损失函数 | 实现Macro F1 Loss / Focal Loss变体 | 3天 | ✅ 完成 |
| **S10-4** | 集成权重 | 调整S7投票权重优化F1 | 2天 | ✅ 完成 |
| **S10-5** | 结果分析 | 对比实验 + 可视化 + 报告 | 2天 | ✅ 完成 |

---

## 🎯 最终成果

| 指标 | 基准 | 最终 | 提升 | 状态 |
|------|------|------|------|------|
| Macro F1 | 0.4133 | **0.5011** | **+21.3%** | ✅ 超额完成 |
| Accuracy | 59.17% | 58.88% | -0.29% | ✅ 可接受 |
| Negative F1 | 0.0000 | **0.2759** | **+27.6%** | ✅ 显著改善 |

### 最终结果对比

| 任务 | Macro F1 | Accuracy | Negative F1 | 说明 |
|------|----------|----------|-------------|------|
| S10-1 | 0.4133 | 59.17% | 0.0000 | 基准 |
| S10-2 | 0.4340 | 58.73% | ~0.10 | 阈值优化 |
| S10-3 | **0.5011** ⭐ | **58.88%** ⭐ | **0.2759** ⭐ | CE训练（最佳） |
| S10-4 | 0.4909 | 56.80% | 0.2581 | 集成权重 |

**推荐模型**: S10-3 CE训练 (`checkpoints/s10_3_ce_best_model.pth`)

---

## 📊 详细任务

### S10-1: 数据分析（1天）

**任务**: 分析当前模型的预测分布

**步骤**:
1. 加载S7-v1模型
2. 在测试集上预测，获取各类别置信度
3. 绘制置信度分布直方图
4. 生成混淆矩阵
5. 计算当前Macro F1

**输出**:
- 预测置信度分布图
- 混淆矩阵
- 当前Macro F1基准

**脚本**: `s10_1_analysis.py`

---

### S10-2: 阈值优化（2天）

**任务**: 网格搜索最优阈值

**方法**:
- 默认阈值: argmax
- 优化阈值: [0.3, 0.4, 0.5] × 3类别组合

**步骤**:
1. 遍历不同阈值组合
2. 计算每种组合的Macro F1
3. 找到最优阈值
4. 评估准确率损失

**输出**:
- 最优阈值组合
- Macro F1提升
- 准确率变化

**脚本**: `s10_2_threshold_optimization.py`

---

### S10-3: 损失函数（3天）

**任务**: 实现F1优化损失函数

**方法**:
- Focal Loss (已实现，可调参)
- Macro F1 Loss (需实现)
- 类别权重微调

**步骤**:
1. 实现Macro F1 Loss
2. 修改训练脚本
3. 训练新模型
4. 评估Macro F1提升

**输出**:
- 新训练模型
- Macro F1对比
- 准确率对比

**脚本**: `s10_3_macro_f1_loss.py` + 修改训练脚本

---

### S10-4: 集成权重（2天）

**任务**: 优化S7投票权重

**方法**:
- 网格搜索: [0.5-2.0] × 2模型
- 目标: 最大化Macro F1

**步骤**:
1. 遍历不同权重组合
2. 计算每种组合的Macro F1
3. 找到最优权重
4. 评估准确率损失

**输出**:
- 最优权重配置
- Macro F1提升
- 准确率变化

**脚本**: `s10_4_ensemble_weights.py`

---

### S10-5: 结果分析（2天）

**任务**: 汇总所有实验结果

**步骤**:
1. 汇总S10-1到S10-4所有结果
2. 生成对比图表
3. 撰写实验报告
4. 更新论文素材

**输出**:
- `S10_MACRO_F1_RESULTS.md`
- Macro F1对比图表
- 更新 `THESIS_MATERIALS.md`

---

## 📁 输出文件

| 文件 | 用途 |
|------|------|
| `s10_1_analysis.py` | 数据分析脚本 |
| `s10_2_threshold_optimization.py` | 阈值优化脚本 |
| `s10_3_macro_f1_loss.py` | F1 Loss实现 |
| `s10_4_ensemble_weights.py` | 权重优化脚本 |
| `S10_MACRO_F1_RESULTS.md` | 实验报告 |

---

## 🔧 相关路径

**模型路径**: `checkpoints/baseline_attention_3class_ce_best_model.pth`
**数据路径**: `data/mosei/processed_cleaned_correct/`
**脚本目录**: 当前根目录

---

**任务状态**: ⏳ 待开始
**最后更新**: 2026-02-09
